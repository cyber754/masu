<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>マス塗り問題</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      background-color: #f0f0f0;
    }
    .grid-wrapper {
      display: grid;
      grid-template-columns: repeat(3, auto);
      gap: 40px;
      justify-content: center;
      margin: 20px auto;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(8, 30px);
      grid-template-rows: repeat(8, 30px);
      gap: 2px;
      margin-bottom: 10px;
    }
    .cell {
      width: 30px;
      height: 30px;
      background-color: white;
      border: 1px solid #aaa;
      cursor: pointer;
    }
    .row-binary {
      font-size: 18px;
      font-family: monospace;
      margin: 0;
    }
    .grid-set {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .section-label {
      font-size: 32px;
      font-weight: bold;
      margin: 50px 0 10px;
    }
    .extra-title {
      font-size: 48px;
      font-weight: bold;
      margin-top: 100px;
    }
    .extra-grid {
      display: grid;
      grid-template-columns: repeat(16, 24px);
      grid-template-rows: repeat(16, 24px);
      gap: 1px;
      margin: 20px auto;
    }
    .extra-cell {
      width: 24px;
      height: 24px;
      background-color: white;
      border: 1px solid #999;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <!-- 暗号X -->
  <div class="section-label">暗号X</div>
  <div class="grid-wrapper">
    <!-- 3グリッド -->
    <script>
      const grids = 9;
      for (let g = 0; g < 9; g++) {
        if (g === 3) document.write('</div><div class="section-label">暗号Y</div><div class="grid-wrapper">');
        if (g === 6) document.write('</div><div class="section-label">暗号Z</div><div class="grid-wrapper">');

        document.write('<div class="grid-set">');
        document.write('<div class="grid" id="grid' + g + '">');
        for (let i = 0; i < 64; i++) {
          document.write('<div class="cell" data-row="' + Math.floor(i / 8) + '"></div>');
        }
        document.write('</div>');
        for (let row = 0; row < 8; row++) {
          document.write('<p class="row-binary" id="binary' + g + '-' + row + '">00000000</p>');
        }
        document.write('</div>');
      }
    </script>
  </div>

  <!-- ドットキャラ画像 -->
  <div style="text-align: center; margin-top: 100px; margin-bottom: 80px;">
    <img src="dot_character_transparent.png" alt="ドットキャラ" 
         style="image-rendering: pixelated; width: 150px; height: auto;">
  </div>

  <!-- えきすとら -->
  <div class="extra-title">えきすとら</div>

  <!-- 16×16 グリッド2つ -->
  <div class="grid-wrapper" style="grid-template-columns: repeat(2, auto);">
    <div class="extra-grid" id="extra1">
      <!-- 256 cells -->
      <script>
        for (let i = 0; i < 256; i++) {
          document.write('<div class="extra-cell"></div>');
        }
      </script>
    </div>
    <div class="extra-grid" id="extra2">
      <script>
        for (let i = 0; i < 256; i++) {
          document.write('<div class="extra-cell"></div>');
        }
      </script>
    </div>
  </div>

  <!-- スクリプト部分 -->
  <script>
    // クリック or ドラッグ対応
    let isMouseDown = false;

    document.addEventListener('mousedown', () => isMouseDown = true);
    document.addEventListener('mouseup', () => isMouseDown = false);

    document.querySelectorAll('.cell').forEach(cell => {
      cell.addEventListener('mousedown', () => toggleCell(cell));
      cell.addEventListener('mouseover', () => {
        if (isMouseDown) toggleCell(cell);
      });
    });

    function toggleCell(cell) {
      const isBlack = cell.style.backgroundColor === 'black';
      cell.style.backgroundColor = isBlack ? 'white' : 'black';
      updateBinary(cell.closest('.grid'));
    }

    function updateBinary(grid) {
      const gridId = grid.id;
      const gridIndex = gridId.replace('grid', '');
      const cells = grid.querySelectorAll('.cell');

      let rows = Array(8).fill('');
      cells.forEach((cell, i) => {
        const row = Math.floor(i / 8);
        rows[row] += cell.style.backgroundColor === 'black' ? '1' : '0';
      });

      rows.forEach((bin, r) => {
        document.getElementById(`binary${gridIndex}-${r}`).textContent = bin;
      });
    }

    // extraセルも塗れるようにする
    document.querySelectorAll('.extra-cell').forEach(cell => {
      cell.addEventListener('mousedown', () => toggleExtra(cell));
      cell.addEventListener('mouseover', () => {
        if (isMouseDown) toggleExtra(cell);
      });
    });

    function toggleExtra(cell) {
      const isBlack = cell.style.backgroundColor === 'black';
      cell.style.backgroundColor = isBlack ? 'white' : 'black';
    }
  </script>

</body>
</html>
